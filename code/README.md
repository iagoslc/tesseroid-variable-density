# Source code for producing the results and figures

The code is divided between Python modules in `tesseroid-density`, Jupyter
notebooks in `notebooks`, and analysis scripts in `scripts`.
The modules implement the methodology and code that is reused in different applications.
This code is tested using `pytest` with the test code in `tests`.

The `Makefile` automates all processes related to executing code.
Run the following to perform all actions from building the software to
generating the final figures:

    make all


## Python package

The `tesseroid-density` package allows to compute the gravity fields generated
by any tesseroids with an arbitrary continuous density function.

The tesseroid geometry must be generated through the
`fatiando.mesher.Tesseroid` class, or a mesh of tesseroids with
`fatiando.mesher.TesseroidMesh`. We can incorporate a density
function to every tesseroid by defining a regular Python function with a single
`height` argument (float or numpy 1d array) that returns a float.


## Building, testing, and linting

Use the `Makefile` to build, test, and lint the software:

* Build and install:

        make build

* Run the static checks using flake8 and pylint:

        make check

* Run the tests in `tests` and doctests in docstrings:

        make test

* Calculate the test coverage of the main Python code (not including the
  notebooks):

        make coverage

## Notebooks

Inside `notebooks` we can find notebooks that show examples on how to use the
package, solve the analytical solutions of the gravity fields generated by a
spherical shell with variable density, determine the optimal parameters needed
to achieve a good numerical approximation of the gravity fields and perform a
forward modelling of the Neuquén Basin using an increasing exponential density
function with depth.

* [01-simple-example.ipynb](): Shows examples on how to use the variable
  density tesseroid code to model a single Tesseroid or Tesseroids meshes and
  compute the gravitational fields they generate.
* [02-spherical-shell-analytical-solutions.ipynb](): Obtains the analytical
  solution for the gravitational potential generated by a spherical shell with
  variable density in the radial direction. Gives specific solutions for
  linear and exponential density functions.
* [03-linear-density-test.ipynb](): Obtains the density-size ratio for the
  for a linear density Tesseroids by comparing the numerical results with the
  analytical solution of the gravitational fields generated by a spherical
  shell with the same linear density.
* [04-density-based-discretization-algorithm.ipynb](): Illustrates how the new
  density-based discretization algorithm works and how a lower value of delta
  produces more subdivisions to the original tesseroids.
* [05-exponential-density-grid-search.ipynb](): Performs a grid search on the
  D-delta space to find the optimal distance-size ratio and delta ratio pair by
  comparing the numerical result with the analytical solution for the spherical
  shell.
* [06-exponential-density-delta-determination.ipynb](): Determines the optimal
  value of delta ratio for several exponential density functions while keeping
  D equal to the values determined in the linear density case.
* [07-neuquen-basin.ipynb](): Forward model of the Neuquén Basin using an
  increasing exponential density.
* [08-plot-figures.ipynb](): Produces ready to publish figures.
